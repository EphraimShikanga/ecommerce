import{i as p}from"./Presence-BOlNR8lw.js";import{t as f,c as y,aa as g,ab as l,ac as C,X as n,Y as a,O as h}from"./index-Bxg717nH.js";function I(t,r=Number.NEGATIVE_INFINITY,o=Number.POSITIVE_INFINITY){return Math.min(o,Math.max(r,t))}function T(t){const r=p({nonce:f()});return y(()=>t?.value||r.nonce?.value)}const m=()=>{try{const t=localStorage.getItem(g.CATEGORY_COLORS);return t?JSON.parse(t):{}}catch{return{}}},E=t=>{try{localStorage.setItem(g.CATEGORY_COLORS,JSON.stringify(t))}catch(r){console.error("Failed to save category colors:",r)}};function L(){const t=f(m());return{getCategoryColor:e=>{if(t.value[e])return t.value[e];const s=Object.values(t.value),c=l.find(u=>!s.includes(u))||l[Math.floor(Math.random()*l.length)]||"border-gray-500 text-gray-600 dark:text-gray-400";return t.value[e]=c,E(t.value),c},formatCategoryName:e=>e.split("-").map(s=>s.charAt(0).toUpperCase()+s.slice(1)).join(" ")}}const O=t=>{const{limit:r=30,skip:o=0,search:e="",category:s=h.ALL,sortBy:i="",order:c="asc"}=t,u=[`limit=${r}`,`skip=${o}`];i&&i.trim()&&u.push(`sortBy=${i}`,`order=${c}`);const d=u.join("&");return e&&e.trim()?`${a.PRODUCTS.SEARCH}?q=${encodeURIComponent(e)}&${d}`:s&&s!==h.ALL?`${a.PRODUCTS.CATEGORY(s)}?${d}`:`${a.PRODUCTS.BASE}?${d}`},R=C("products",{state:()=>({products:[],total:0,isLoading:!1,error:null}),getters:{getProductById:t=>r=>t.products.find(o=>o.id===r)},actions:{async fetchProducts(t={}){this.isLoading=!0,this.error=null;try{const r=O(t),o=await n(r);this.products=o.products,this.total=o.total}catch(r){this.error=r instanceof Error?r.message:"Failed to fetch products",console.error("Error fetching products:",r)}finally{this.isLoading=!1}},async fetchSingleProduct(t){this.isLoading=!0,this.error=null;try{const r=await n(a.PRODUCTS.BY_ID(t)),o=this.products.findIndex(e=>e.id===t);return o!==-1?this.products[o]=r:this.products.push(r),r}catch(r){return this.error=r instanceof Error?r.message:"Failed to fetch product",console.error("Error fetching product:",r),null}finally{this.isLoading=!1}},async addProduct(t){this.isLoading=!0,this.error=null;try{const r=await n(a.PRODUCTS.ADD,{method:"POST",body:JSON.stringify(t)});return this.products.unshift(r),this.total++,r}catch(r){return this.error=r instanceof Error?r.message:"Failed to add product",console.error("Error adding product:",r),null}finally{this.isLoading=!1}},async updateProduct(t,r){this.isLoading=!0,this.error=null;try{const o=await n(a.PRODUCTS.BY_ID(t),{method:"PUT",body:JSON.stringify(r)}),e=this.products.findIndex(s=>s.id===t);return e!==-1&&(this.products[e]=o),o}catch(o){return this.error=o instanceof Error?o.message:"Failed to update product",console.error("Error updating product:",o),null}finally{this.isLoading=!1}},async deleteProduct(t){this.isLoading=!0,this.error=null;try{await n(a.PRODUCTS.BY_ID(t),{method:"DELETE"});const r=this.products.findIndex(o=>o.id===t);return r!==-1&&(this.products.splice(r,1),this.total--),!0}catch(r){return this.error=r instanceof Error?r.message:"Failed to delete product",console.error("Error deleting product:",r),!1}finally{this.isLoading=!1}},clearError(){this.error=null}}});export{L as a,T as b,I as c,R as u};
